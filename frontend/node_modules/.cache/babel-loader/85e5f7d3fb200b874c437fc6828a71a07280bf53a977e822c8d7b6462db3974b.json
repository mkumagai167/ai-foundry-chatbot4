{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport { AccountSASPermissions } from \"./AccountSASPermissions.js\";\nimport { AccountSASResourceTypes } from \"./AccountSASResourceTypes.js\";\nimport { AccountSASServices } from \"./AccountSASServices.js\";\nimport { ipRangeToString } from \"./SasIPRange.js\";\nimport { SASQueryParameters } from \"./SASQueryParameters.js\";\nimport { SERVICE_VERSION } from \"../utils/constants.js\";\nimport { truncatedISO8061Date } from \"../utils/utils.common.js\";\n/**\n * ONLY AVAILABLE IN NODE.JS RUNTIME.\n *\n * Generates a {@link SASQueryParameters} object which contains all SAS query parameters needed to make an actual\n * REST request.\n *\n * @see https://learn.microsoft.com/rest/api/storageservices/constructing-an-account-sas\n *\n * @param accountSASSignatureValues -\n * @param sharedKeyCredential -\n */\nexport function generateAccountSASQueryParameters(accountSASSignatureValues, sharedKeyCredential) {\n  return generateAccountSASQueryParametersInternal(accountSASSignatureValues, sharedKeyCredential).sasQueryParameters;\n}\nexport function generateAccountSASQueryParametersInternal(accountSASSignatureValues, sharedKeyCredential) {\n  const version = accountSASSignatureValues.version ? accountSASSignatureValues.version : SERVICE_VERSION;\n  if (accountSASSignatureValues.permissions && accountSASSignatureValues.permissions.setImmutabilityPolicy && version < \"2020-08-04\") {\n    throw RangeError(\"'version' must be >= '2020-08-04' when provided 'i' permission.\");\n  }\n  if (accountSASSignatureValues.permissions && accountSASSignatureValues.permissions.deleteVersion && version < \"2019-10-10\") {\n    throw RangeError(\"'version' must be >= '2019-10-10' when provided 'x' permission.\");\n  }\n  if (accountSASSignatureValues.permissions && accountSASSignatureValues.permissions.permanentDelete && version < \"2019-10-10\") {\n    throw RangeError(\"'version' must be >= '2019-10-10' when provided 'y' permission.\");\n  }\n  if (accountSASSignatureValues.permissions && accountSASSignatureValues.permissions.tag && version < \"2019-12-12\") {\n    throw RangeError(\"'version' must be >= '2019-12-12' when provided 't' permission.\");\n  }\n  if (accountSASSignatureValues.permissions && accountSASSignatureValues.permissions.filter && version < \"2019-12-12\") {\n    throw RangeError(\"'version' must be >= '2019-12-12' when provided 'f' permission.\");\n  }\n  if (accountSASSignatureValues.encryptionScope && version < \"2020-12-06\") {\n    throw RangeError(\"'version' must be >= '2020-12-06' when provided 'encryptionScope' in SAS.\");\n  }\n  const parsedPermissions = AccountSASPermissions.parse(accountSASSignatureValues.permissions.toString());\n  const parsedServices = AccountSASServices.parse(accountSASSignatureValues.services).toString();\n  const parsedResourceTypes = AccountSASResourceTypes.parse(accountSASSignatureValues.resourceTypes).toString();\n  let stringToSign;\n  if (version >= \"2020-12-06\") {\n    stringToSign = [sharedKeyCredential.accountName, parsedPermissions, parsedServices, parsedResourceTypes, accountSASSignatureValues.startsOn ? truncatedISO8061Date(accountSASSignatureValues.startsOn, false) : \"\", truncatedISO8061Date(accountSASSignatureValues.expiresOn, false), accountSASSignatureValues.ipRange ? ipRangeToString(accountSASSignatureValues.ipRange) : \"\", accountSASSignatureValues.protocol ? accountSASSignatureValues.protocol : \"\", version, accountSASSignatureValues.encryptionScope ? accountSASSignatureValues.encryptionScope : \"\", \"\" // Account SAS requires an additional newline character\n    ].join(\"\\n\");\n  } else {\n    stringToSign = [sharedKeyCredential.accountName, parsedPermissions, parsedServices, parsedResourceTypes, accountSASSignatureValues.startsOn ? truncatedISO8061Date(accountSASSignatureValues.startsOn, false) : \"\", truncatedISO8061Date(accountSASSignatureValues.expiresOn, false), accountSASSignatureValues.ipRange ? ipRangeToString(accountSASSignatureValues.ipRange) : \"\", accountSASSignatureValues.protocol ? accountSASSignatureValues.protocol : \"\", version, \"\" // Account SAS requires an additional newline character\n    ].join(\"\\n\");\n  }\n  const signature = sharedKeyCredential.computeHMACSHA256(stringToSign);\n  return {\n    sasQueryParameters: new SASQueryParameters(version, signature, parsedPermissions.toString(), parsedServices, parsedResourceTypes, accountSASSignatureValues.protocol, accountSASSignatureValues.startsOn, accountSASSignatureValues.expiresOn, accountSASSignatureValues.ipRange, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, accountSASSignatureValues.encryptionScope),\n    stringToSign: stringToSign\n  };\n}","map":{"version":3,"names":["AccountSASPermissions","AccountSASResourceTypes","AccountSASServices","ipRangeToString","SASQueryParameters","SERVICE_VERSION","truncatedISO8061Date","generateAccountSASQueryParameters","accountSASSignatureValues","sharedKeyCredential","generateAccountSASQueryParametersInternal","sasQueryParameters","version","permissions","setImmutabilityPolicy","RangeError","deleteVersion","permanentDelete","tag","filter","encryptionScope","parsedPermissions","parse","toString","parsedServices","services","parsedResourceTypes","resourceTypes","stringToSign","accountName","startsOn","expiresOn","ipRange","protocol","join","signature","computeHMACSHA256","undefined"],"sources":["C:\\Users\\M.Kumagai\\Documents\\React\\ai-foundry-chatbot4\\frontend\\node_modules\\@azure\\storage-blob\\src\\sas\\AccountSASSignatureValues.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport { AccountSASPermissions } from \"./AccountSASPermissions.js\";\nimport { AccountSASResourceTypes } from \"./AccountSASResourceTypes.js\";\nimport { AccountSASServices } from \"./AccountSASServices.js\";\nimport type { StorageSharedKeyCredential } from \"../credentials/StorageSharedKeyCredential.js\";\nimport type { SasIPRange } from \"./SasIPRange.js\";\nimport { ipRangeToString } from \"./SasIPRange.js\";\nimport type { SASProtocol } from \"./SASQueryParameters.js\";\nimport { SASQueryParameters } from \"./SASQueryParameters.js\";\nimport { SERVICE_VERSION } from \"../utils/constants.js\";\nimport { truncatedISO8061Date } from \"../utils/utils.common.js\";\n\n/**\n * ONLY AVAILABLE IN NODE.JS RUNTIME.\n *\n * AccountSASSignatureValues is used to generate a Shared Access Signature (SAS) for an Azure Storage account. Once\n * all the values here are set appropriately, call {@link generateAccountSASQueryParameters} to obtain a representation\n * of the SAS which can actually be applied to blob urls. Note: that both this class and {@link SASQueryParameters}\n * exist because the former is mutable and a logical representation while the latter is immutable and used to generate\n * actual REST requests.\n *\n * @see https://learn.microsoft.com/azure/storage/common/storage-dotnet-shared-access-signature-part-1\n * for more conceptual information on SAS\n *\n * @see https://learn.microsoft.com/rest/api/storageservices/constructing-an-account-sas\n * for descriptions of the parameters, including which are required\n */\nexport interface AccountSASSignatureValues {\n  /**\n   * If not provided, this defaults to the service version targeted by this version of the library.\n   */\n  version?: string;\n\n  /**\n   * Optional. SAS protocols allowed.\n   */\n  protocol?: SASProtocol;\n\n  /**\n   * Optional. When the SAS will take effect.\n   */\n  startsOn?: Date;\n\n  /**\n   * The time after which the SAS will no longer work.\n   */\n  expiresOn: Date;\n\n  /**\n   * Specifies which operations the SAS user may perform. Please refer to {@link AccountSASPermissions} for help\n   * constructing the permissions string.\n   */\n  permissions: AccountSASPermissions;\n\n  /**\n   * Optional. IP range allowed.\n   */\n  ipRange?: SasIPRange;\n\n  /**\n   * The values that indicate the services accessible with this SAS. Please refer to {@link AccountSASServices} to\n   * construct this value.\n   */\n  services: string;\n\n  /**\n   * The values that indicate the resource types accessible with this SAS. Please refer\n   * to {@link AccountSASResourceTypes} to construct this value.\n   */\n  resourceTypes: string;\n\n  /**\n   * Optional. Encryption scope to use when sending requests authorized with this SAS URI.\n   */\n  encryptionScope?: string;\n}\n\n/**\n * ONLY AVAILABLE IN NODE.JS RUNTIME.\n *\n * Generates a {@link SASQueryParameters} object which contains all SAS query parameters needed to make an actual\n * REST request.\n *\n * @see https://learn.microsoft.com/rest/api/storageservices/constructing-an-account-sas\n *\n * @param accountSASSignatureValues -\n * @param sharedKeyCredential -\n */\nexport function generateAccountSASQueryParameters(\n  accountSASSignatureValues: AccountSASSignatureValues,\n  sharedKeyCredential: StorageSharedKeyCredential,\n): SASQueryParameters {\n  return generateAccountSASQueryParametersInternal(accountSASSignatureValues, sharedKeyCredential)\n    .sasQueryParameters;\n}\n\nexport function generateAccountSASQueryParametersInternal(\n  accountSASSignatureValues: AccountSASSignatureValues,\n  sharedKeyCredential: StorageSharedKeyCredential,\n): { sasQueryParameters: SASQueryParameters; stringToSign: string } {\n  const version = accountSASSignatureValues.version\n    ? accountSASSignatureValues.version\n    : SERVICE_VERSION;\n\n  if (\n    accountSASSignatureValues.permissions &&\n    accountSASSignatureValues.permissions.setImmutabilityPolicy &&\n    version < \"2020-08-04\"\n  ) {\n    throw RangeError(\"'version' must be >= '2020-08-04' when provided 'i' permission.\");\n  }\n\n  if (\n    accountSASSignatureValues.permissions &&\n    accountSASSignatureValues.permissions.deleteVersion &&\n    version < \"2019-10-10\"\n  ) {\n    throw RangeError(\"'version' must be >= '2019-10-10' when provided 'x' permission.\");\n  }\n\n  if (\n    accountSASSignatureValues.permissions &&\n    accountSASSignatureValues.permissions.permanentDelete &&\n    version < \"2019-10-10\"\n  ) {\n    throw RangeError(\"'version' must be >= '2019-10-10' when provided 'y' permission.\");\n  }\n\n  if (\n    accountSASSignatureValues.permissions &&\n    accountSASSignatureValues.permissions.tag &&\n    version < \"2019-12-12\"\n  ) {\n    throw RangeError(\"'version' must be >= '2019-12-12' when provided 't' permission.\");\n  }\n\n  if (\n    accountSASSignatureValues.permissions &&\n    accountSASSignatureValues.permissions.filter &&\n    version < \"2019-12-12\"\n  ) {\n    throw RangeError(\"'version' must be >= '2019-12-12' when provided 'f' permission.\");\n  }\n\n  if (accountSASSignatureValues.encryptionScope && version < \"2020-12-06\") {\n    throw RangeError(\"'version' must be >= '2020-12-06' when provided 'encryptionScope' in SAS.\");\n  }\n\n  const parsedPermissions = AccountSASPermissions.parse(\n    accountSASSignatureValues.permissions.toString(),\n  );\n  const parsedServices = AccountSASServices.parse(accountSASSignatureValues.services).toString();\n  const parsedResourceTypes = AccountSASResourceTypes.parse(\n    accountSASSignatureValues.resourceTypes,\n  ).toString();\n\n  let stringToSign: string;\n\n  if (version >= \"2020-12-06\") {\n    stringToSign = [\n      sharedKeyCredential.accountName,\n      parsedPermissions,\n      parsedServices,\n      parsedResourceTypes,\n      accountSASSignatureValues.startsOn\n        ? truncatedISO8061Date(accountSASSignatureValues.startsOn, false)\n        : \"\",\n      truncatedISO8061Date(accountSASSignatureValues.expiresOn, false),\n      accountSASSignatureValues.ipRange ? ipRangeToString(accountSASSignatureValues.ipRange) : \"\",\n      accountSASSignatureValues.protocol ? accountSASSignatureValues.protocol : \"\",\n      version,\n      accountSASSignatureValues.encryptionScope ? accountSASSignatureValues.encryptionScope : \"\",\n      \"\", // Account SAS requires an additional newline character\n    ].join(\"\\n\");\n  } else {\n    stringToSign = [\n      sharedKeyCredential.accountName,\n      parsedPermissions,\n      parsedServices,\n      parsedResourceTypes,\n      accountSASSignatureValues.startsOn\n        ? truncatedISO8061Date(accountSASSignatureValues.startsOn, false)\n        : \"\",\n      truncatedISO8061Date(accountSASSignatureValues.expiresOn, false),\n      accountSASSignatureValues.ipRange ? ipRangeToString(accountSASSignatureValues.ipRange) : \"\",\n      accountSASSignatureValues.protocol ? accountSASSignatureValues.protocol : \"\",\n      version,\n      \"\", // Account SAS requires an additional newline character\n    ].join(\"\\n\");\n  }\n\n  const signature: string = sharedKeyCredential.computeHMACSHA256(stringToSign);\n\n  return {\n    sasQueryParameters: new SASQueryParameters(\n      version,\n      signature,\n      parsedPermissions.toString(),\n      parsedServices,\n      parsedResourceTypes,\n      accountSASSignatureValues.protocol,\n      accountSASSignatureValues.startsOn,\n      accountSASSignatureValues.expiresOn,\n      accountSASSignatureValues.ipRange,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      undefined,\n      accountSASSignatureValues.encryptionScope,\n    ),\n    stringToSign: stringToSign,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}