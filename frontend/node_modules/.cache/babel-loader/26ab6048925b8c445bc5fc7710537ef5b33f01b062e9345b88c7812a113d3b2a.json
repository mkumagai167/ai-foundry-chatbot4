{"ast":null,"code":"// frontend/src/components/Chat.jsx\nimport React,{useState}from\"react\";import{useMsal}from\"@azure/msal-react\";import{postToBackend}from\"../services/api\";import ReactMarkdown from\"react-markdown\";import FileUpload from\"./FileUpload\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Chat(_ref){let{messages,setMessages}=_ref;const{instance,accounts}=useMsal();const account=accounts[0];const[text,setText]=useState(\"\");const[threadId,setThreadId]=useState(null);const[loading,setLoading]=useState(false);const[attachedFileIds,setAttachedFileIds]=useState([]);async function send(){if(!text.trim())return;const userMsg={role:\"user\",text,time:new Date().toISOString()};setMessages(prev=>[...prev,userMsg]);setText(\"\");setLoading(true);try{const tokenResponse=await instance.acquireTokenSilent({scopes:[\"api://9630bd34-dff3-4fb7-84f6-cccca22c95ca/.default\"],account});const accessToken=tokenResponse.accessToken;const resp=await postToBackend(userMsg.text,accessToken,attachedFileIds,threadId);if(resp.threadId&&!threadId){setThreadId(resp.threadId);}const assistantMessages=(resp.assistantMessages||[]).map(m=>({role:\"assistant\",text:m.content?m.content.map(c=>{var _c$text;return((_c$text=c.text)===null||_c$text===void 0?void 0:_c$text.value)||\"\";}).join(\"\\n\"):m.text||\"\",time:m.createdAt}));setMessages(prev=>[...prev,...assistantMessages]);setAttachedFileIds([]);// clear after use\n}catch(err){console.error(\"Chat error:\",err);setMessages(prev=>[...prev,{role:\"system\",text:\"Error: \".concat(err.message),time:new Date().toISOString()}]);}finally{setLoading(false);}}return/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"column\",height:\"75vh\"},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:1,overflowY:\"auto\",border:\"1px solid #ccc\",borderRadius:6,padding:12,marginBottom:10},children:messages.map((m,i)=>/*#__PURE__*/_jsx(\"div\",{style:{margin:\"8px 0\",textAlign:m.role===\"user\"?\"right\":\"left\"},children:/*#__PURE__*/_jsx(\"span\",{style:{display:\"inline-block\",background:m.role===\"user\"?\"#0078d7\":\"#f3f2f1\",color:m.role===\"user\"?\"white\":\"black\",padding:\"8px 12px\",borderRadius:12,maxWidth:\"75%\",wordBreak:\"break-word\"},children:/*#__PURE__*/_jsx(ReactMarkdown,{children:m.text})})},i))}),/*#__PURE__*/_jsx(FileUpload,{onFileUploaded:fileId=>{setAttachedFileIds(prev=>[...prev,fileId]);}}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8,marginTop:10},children:[/*#__PURE__*/_jsx(\"input\",{value:text,onChange:e=>setText(e.target.value),style:{flex:1,padding:\"8px\"},onKeyDown:e=>e.key===\"Enter\"&&send(),placeholder:\"Type a message...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:send,disabled:loading,children:loading?\"Sending...\":\"Send\"})]})]});}","map":{"version":3,"names":["React","useState","useMsal","postToBackend","ReactMarkdown","FileUpload","jsx","_jsx","jsxs","_jsxs","Chat","_ref","messages","setMessages","instance","accounts","account","text","setText","threadId","setThreadId","loading","setLoading","attachedFileIds","setAttachedFileIds","send","trim","userMsg","role","time","Date","toISOString","prev","tokenResponse","acquireTokenSilent","scopes","accessToken","resp","assistantMessages","map","m","content","c","_c$text","value","join","createdAt","err","console","error","concat","message","style","display","flexDirection","height","children","flex","overflowY","border","borderRadius","padding","marginBottom","i","margin","textAlign","background","color","maxWidth","wordBreak","onFileUploaded","fileId","gap","marginTop","onChange","e","target","onKeyDown","key","placeholder","onClick","disabled"],"sources":["C:/Users/M.Kumagai/Documents/React/ai-foundry-chatbot4/frontend/src/components/Chat.jsx"],"sourcesContent":["// frontend/src/components/Chat.jsx\r\nimport React, { useState } from \"react\";\r\nimport { useMsal } from \"@azure/msal-react\";\r\nimport { postToBackend } from \"../services/api\";\r\nimport ReactMarkdown from \"react-markdown\";\r\nimport FileUpload from \"./FileUpload\";\r\n\r\nexport default function Chat({ messages, setMessages }) {\r\n  const { instance, accounts } = useMsal();\r\n  const account = accounts[0];\r\n\r\n  const [text, setText] = useState(\"\");\r\n  const [threadId, setThreadId] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [attachedFileIds, setAttachedFileIds] = useState([]);\r\n\r\n  async function send() {\r\n    if (!text.trim()) return;\r\n\r\n    const userMsg = {\r\n      role: \"user\",\r\n      text,\r\n      time: new Date().toISOString(),\r\n    };\r\n    setMessages((prev) => [...prev, userMsg]);\r\n    setText(\"\");\r\n    setLoading(true);\r\n\r\n    try {\r\n      const tokenResponse = await instance.acquireTokenSilent({\r\n        scopes: [\"api://9630bd34-dff3-4fb7-84f6-cccca22c95ca/.default\"],\r\n        account,\r\n      });\r\n\r\n      const accessToken = tokenResponse.accessToken;\r\n\r\n      const resp = await postToBackend(\r\n        userMsg.text,\r\n        accessToken,\r\n        attachedFileIds,\r\n        threadId\r\n      );\r\n\r\n      if (resp.threadId && !threadId) {\r\n        setThreadId(resp.threadId);\r\n      }\r\n\r\n      const assistantMessages = (resp.assistantMessages || []).map((m) => ({\r\n        role: \"assistant\",\r\n        text: m.content\r\n          ? m.content.map((c) => c.text?.value || \"\").join(\"\\n\")\r\n          : m.text || \"\",\r\n        time: m.createdAt,\r\n      }));\r\n\r\n      setMessages((prev) => [...prev, ...assistantMessages]);\r\n      setAttachedFileIds([]); // clear after use\r\n    } catch (err) {\r\n      console.error(\"Chat error:\", err);\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          role: \"system\",\r\n          text: `Error: ${err.message}`,\r\n          time: new Date().toISOString(),\r\n        },\r\n      ]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: \"flex\", flexDirection: \"column\", height: \"75vh\" }}>\r\n      <div\r\n        style={{\r\n          flex: 1,\r\n          overflowY: \"auto\",\r\n          border: \"1px solid #ccc\",\r\n          borderRadius: 6,\r\n          padding: 12,\r\n          marginBottom: 10,\r\n        }}\r\n      >\r\n        {messages.map((m, i) => (\r\n          <div\r\n            key={i}\r\n            style={{\r\n              margin: \"8px 0\",\r\n              textAlign: m.role === \"user\" ? \"right\" : \"left\",\r\n            }}\r\n          >\r\n            <span\r\n              style={{\r\n                display: \"inline-block\",\r\n                background: m.role === \"user\" ? \"#0078d7\" : \"#f3f2f1\",\r\n                color: m.role === \"user\" ? \"white\" : \"black\",\r\n                padding: \"8px 12px\",\r\n                borderRadius: 12,\r\n                maxWidth: \"75%\",\r\n                wordBreak: \"break-word\",\r\n              }}\r\n            >\r\n              <ReactMarkdown>{m.text}</ReactMarkdown>\r\n            </span>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <FileUpload\r\n        onFileUploaded={(fileId) => {\r\n          setAttachedFileIds((prev) => [...prev, fileId]);\r\n        }}\r\n      />\r\n\r\n      <div style={{ display: \"flex\", gap: 8, marginTop: 10 }}>\r\n        <input\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          style={{ flex: 1, padding: \"8px\" }}\r\n          onKeyDown={(e) => e.key === \"Enter\" && send()}\r\n          placeholder=\"Type a message...\"\r\n        />\r\n        <button onClick={send} disabled={loading}>\r\n          {loading ? \"Sending...\" : \"Send\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}